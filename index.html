<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‚öΩ Fu√üball To-Do Liste</title>
<style>
:root{
  --bg:#0b3d0b; --card:#ffffffcc; --text:#0b3d0b; --accent:#ffd700; --accent-hover:#ffcc00;
}
body.dark{--bg:#072107;--card:#1a1a1acc;--text:#fff;--accent:#ffd700;--accent-hover:#ffcc00;}
body{font-family:'Arial',sans-serif;margin:0;padding:20px;background:var(--bg);color:var(--text);transition:background .3s,color .3s;}
h1,h2,h3{margin-top:0;text-align:center;}
.container{max-width:700px;margin:auto;}
.card{background:var(--card);border-radius:12px;padding:20px;margin-bottom:20px;box-shadow:0 4px 10px rgba(0,0,0,.2);transition: background .3s;}
input,button{padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ccc;font-size:1rem;}
input{width: calc(100% - 20px);}
button{background:var(--accent);color:white;border:none;cursor:pointer;transition: background .2s;font-weight:bold;}
button:hover{background:var(--accent-hover);}
.hidden{display:none;}
.todo{border:1px solid #ddd;border-radius:10px;padding:15px;margin:10px 0;background:var(--card);box-shadow:0 2px 5px rgba(0,0,0,.1);}
.task-header{display:flex;justify-content:space-between;align-items:center;}
.theme-toggle{float:right;background:transparent;border:2px solid var(--accent);color:var(--accent);padding:6px 12px;border-radius:8px;font-size:0.9rem;}
.theme-toggle:hover{background:var(--accent);color:#000;}
.football-header{font-family:'Impact', sans-serif; color:var(--accent);}
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<div class="container">
<button class="theme-toggle" onclick="toggleTheme()">üåô Dark Mode</button>
<h1 class="football-header">‚öΩ Fu√üball To-Do Liste</h1>

<!-- LOGIN-BEREICH -->
<div id="loginDiv" class="card">
  <h2>Login</h2>
  <input type="email" id="loginEmail" placeholder="Email"><br>
  <input type="password" id="loginPassword" placeholder="Passwort"><br>
  <button type="button" onclick="loginUser()">Login</button>
  <p id="loginError" style="color:red;"></p>
</div>

<!-- REGISTRIERUNG-BEREICH -->
<div id="registerDiv" class="card">
  <h2>Registrierung</h2>
  <input type="email" id="regEmail" placeholder="Email"><br>
  <input type="password" id="regPassword" placeholder="Passwort"><br>
  <button type="button" onclick="registerUser()">Registrieren</button>
  <p id="registerError" style="color:red;"></p>
</div>

<!-- TO-DO LISTE -->
<div id="todoDiv" class="hidden card">
  <h2>Hallo, <span id="userName"></span>!</h2>
  <div class="card">
    <h3>Neue Aufgabe</h3>
    <input type="text" id="taskTitle" placeholder="Titel der Aufgabe">
    <input type="date" id="taskDate">
    <input type="time" id="taskTime">
    <input type="text" id="taskNote" placeholder="Mitteilung (optional)">
    <button type="button" onclick="addTask()">‚ûï Hinzuf√ºgen</button>
  </div>
  <h3>Aufgaben:</h3>
  <div id="taskList"></div>
</div>

<script>
let currentUser=null;
const adminEmails=["admin@example.com"]; // Admins

// Dark Mode
if(localStorage.getItem("theme")==="dark"){
  document.body.classList.add("dark");
  document.querySelector(".theme-toggle").innerText="‚òÄÔ∏è Light Mode";
}
function toggleTheme(){
  document.body.classList.toggle("dark"); 
  const btn=document.querySelector(".theme-toggle"); 
  if(document.body.classList.contains("dark")){
    localStorage.setItem("theme","dark"); 
    btn.innerText="‚òÄÔ∏è Light Mode";
  } else {
    localStorage.setItem("theme","light"); 
    btn.innerText="üåô Dark Mode";
  }
}

// Supabase
const SUPABASE_URL = 'https://qmixopnpojywdayctmhp.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFtaXhvcG5wb2p5d2FheWN0bWhwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk1MDE0NjQsImV4cCI6MjA3NTA3NzQ2NH0.MPMhA0-G2_nFysi0Vvb57b8CmrxxLh_oxlStnKU_UcA';
const supabase = Supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// Testbenutzer Marvin/12345
async function addTestUser(){
  try {
    await supabase.auth.signUp({email:"marvin@example.com",password:"12345"});
    console.log("Testbenutzer Marvin erstellt (falls nicht vorhanden)");
  } catch(e){
    console.log("Marvin existiert m√∂glicherweise schon", e);
  }
}
addTestUser();

// Registrierung
async function registerUser(){
  const email=document.getElementById("regEmail").value;
  const password=document.getElementById("regPassword").value;
  document.getElementById("registerError").innerText="";
  if(!email||!password){ 
    document.getElementById("registerError").innerText="Email und Passwort erforderlich"; 
    return;
  }
  const { data, error } = await supabase.auth.signUp({email,password});
  if(error){ 
    document.getElementById("registerError").innerText=error.message;
  } else { 
    alert("Registriert! Bitte Mail best√§tigen, falls aktiviert."); 
  }
}

// Login
async function loginUser(){
  const email=document.getElementById("loginEmail").value;
  const password=document.getElementById("loginPassword").value;
  document.getElementById("loginError").innerText="";
  if(!email||!password){ 
    document.getElementById("loginError").innerText="Email und Passwort erforderlich"; 
    return;
  }
  const { data, error } = await supabase.auth.signInWithPassword({email,password});
  if(error){ 
    document.getElementById("loginError").innerText=error.message; 
    return;
  }
  currentUser = data.user;
  onLogin();
}

// Nach Login
function onLogin(){
  document.getElementById("loginDiv").classList.add("hidden");
  document.getElementById("registerDiv").classList.add("hidden");
  document.getElementById("todoDiv").classList.remove("hidden");
  document.getElementById("userName").innerText=currentUser.email;
  loadTasks();
}

// Aufgabe hinzuf√ºgen
async function addTask(){
  const title=document.getElementById("taskTitle").value;
  const date=document.getElementById("taskDate").value;
  const time=document.getElementById("taskTime").value;
  const note=document.getElementById("taskNote").value;
  if(!title||!date||!time){ alert("Pflichtfelder ausf√ºllen"); return;}
  await supabase.from('tasks').insert([{user_id:currentUser.id,title,date,time,note}]);
  document.getElementById("taskTitle").value=""; 
  document.getElementById("taskDate").value=""; 
  document.getElementById("taskTime").value=""; 
  document.getElementById("taskNote").value="";
  loadTasks();
}

// Aufgaben laden
async function loadTasks(){
  let { data, error } = await supabase.from('tasks').select('*').order('created_at',{ascending:true});
  if(error){ console.error(error); return;}
  const listDiv=document.getElementById("taskList");
  listDiv.innerHTML="";
  data.forEach(task=>{
    if(!adminEmails.includes(currentUser.email) && task.user_id!==currentUser.id) return;
    const div=document.createElement("div");
    div.className="todo";
    div.innerHTML=`<div class="task-header"><strong>${task.title}</strong><button onclick="deleteTask(${task.id})">‚ùå</button></div>üìÖ ${task.date} ‚è∞ ${task.time}<br>üí¨ ${task.note || "(keine Mitteilung)"}`;
    listDiv.appendChild(div);
  });
}

// Aufgabe l√∂schen
async function deleteTask(id){
  await supabase.from('tasks').delete().eq('id',id);
  loadTasks();
}
</script>
</body>
</html>
